{% extends "base.html" %}

{% block title %}Управление предметами - AI Бот{% endblock %}

{% block content %}
<div class="header">
    <a href="{{ url_for('main') }}" class="btn-back">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Назад
    </a>
    <h2>Управление предметами</h2>
    <div></div>
</div>

<div class="container">
    <div class="card mb-20">
        <h3 class="card-title">Добавить предмет</h3>
        <form id="addSubjectForm">
            <div class="form-group">
                <label class="form-label">Название</label>
                <input type="text" class="form-input" name="name" required>
            </div>
            <div class="form-group">
                <label class="form-label">Описание</label>
                <textarea class="form-textarea" name="description"></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-block">Добавить</button>
        </form>
    </div>
    
    <div class="card">
        <h3 class="card-title">Список предметов</h3>
        <div class="subjects-grid">
            {% for subject in subjects %}
            <div class="subject-card">
                <h4>{{ subject.name }}</h4>
                {% if subject.description %}
                <p style="font-size: 12px; color: var(--text-secondary);">{{ subject.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.getElementById('addSubjectForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        
        showLoading();
        try {
            const response = await fetch('{{ url_for("admin_subjects") }}', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'include',
                body: JSON.stringify(data)
            });
            const result = await response.json();
            hideLoading();
            
            if (result.success) {
                showNotification('Предмет добавлен', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification('Ошибка добавления предмета', 'error');
            }
        } catch (error) {
            hideLoading();
            showNotification('Ошибка соединения', 'error');
        }
    });
</script>
{% endblock %}

