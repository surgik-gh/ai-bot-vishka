# Руководство по диагностике проблем

## Проблема 1: SDK установлен, но система пишет что не установлен

### Проверка установки SDK

1. Проверьте, что пакет установлен:
   ```bash
   pip list | findstr gigachat
   ```
   или
   ```bash
   pip show gigachat
   ```

2. Проверьте импорт в Python:
   ```python
   python -c "from gigachat import GigaChat; print('OK')"
   ```

3. Если импорт не работает, переустановите:
   ```bash
   pip uninstall gigachat
   pip install gigachat
   ```

### Возможные причины

- **Неправильное имя пакета**: Убедитесь, что пакет называется `gigachat` (не `giga-chat` или другое)
- **Виртуальное окружение**: Убедитесь, что вы установили пакет в правильное виртуальное окружение
- **Кэш Python**: Очистите кэш:
   ```bash
   python -m pip cache purge
   ```

### Что смотреть в логах

При запуске приложения вы должны увидеть:
- `INFO: GigaChat SDK найден и готов к использованию` - SDK найден
- `INFO: Попытка инициализации GigaChat SDK...` - попытка инициализации
- `INFO: GigaChat SDK успешно инициализирован, токен получен` - успех

Если видите:
- `WARNING: Официальный SDK GigaChat не установлен` - SDK не найден
- `ERROR: Не удалось инициализировать GigaChat SDK` - проблема с инициализацией

## Проблема 2: Не генерируется аватар

### Проверка настроек Kandinsky

1. Проверьте `.env` файл:
   ```env
   KANDINSKY_API_KEY=ваш-api-key
   KANDINSKY_SECRET_KEY=ваш-secret-key
   ```

2. Убедитесь, что ключи без кавычек и пробелов

3. Проверьте, что ключи активны в [FusionBrain AI](https://fusionbrain.ai/)

### Что смотреть в логах

При создании эксперта вы должны увидеть последовательность:

1. `INFO: Начало генерации эксперта...`
2. `INFO: Генерация промпта эксперта через GigaChat...`
3. `INFO: Промпт эксперта получен...`
4. `INFO: Генерация описания аватара через GigaChat...`
5. `INFO: Описание аватара получено...`
6. `INFO: Запуск генерации изображения аватара через Kandinsky...`
7. `INFO: Отправка запроса в Kandinsky API...`
8. `INFO: Kandinsky ответ: Status 200`
9. `INFO: Kandinsky UUID получен...`
10. `INFO: Kandinsky статус (попытка X/30): PROCESSING` или `DONE`
11. `INFO: Kandinsky изображение готово...`

### Возможные проблемы

#### Ошибка: "Kandinsky API ключи не настроены"
- Проверьте `.env` файл
- Убедитесь, что переменные называются правильно: `KANDINSKY_API_KEY` и `KANDINSKY_SECRET_KEY`
- Перезапустите приложение после изменения `.env`

#### Ошибка: "Kandinsky API HTTP Error: 401"
- Неправильные ключи API
- Ключи истекли или неактивны
- Проверьте ключи в личном кабинете FusionBrain

#### Ошибка: "Kandinsky API HTTP Error: 403"
- Недостаточно прав у API ключей
- Проверьте тарифный план

#### Ошибка: "Превышено время ожидания"
- Генерация занимает больше 60 секунд
- Попробуйте еще раз или проверьте статус сервиса Kandinsky

#### Статус: "FAIL"
- Промпт не подходит для генерации
- Проверьте логи для деталей ошибки

### Тестирование Kandinsky API вручную

Можно протестировать API напрямую:

```python
import requests

headers = {
    'X-Key': 'Key ваш-api-key',
    'X-Secret': 'Secret ваш-secret-key'
}

data = {
    'type': 'GENERATE',
    'numImages': 1,
    'width': 1024,
    'height': 1024,
    'generateParams': {
        'query': 'Профессиональный портрет преподавателя'
    }
}

response = requests.post(
    'https://api-key.fusionbrain.ai/key/api/v1/text2image/run',
    headers=headers,
    json=data
)

print(response.status_code)
print(response.json())
```

## Общие рекомендации

1. **Всегда проверяйте логи** - они содержат подробную информацию о каждом шаге
2. **Перезапускайте приложение** после изменения `.env`
3. **Проверяйте формат ключей** - без кавычек, пробелов, правильный префикс
4. **Используйте виртуальное окружение** для изоляции зависимостей

