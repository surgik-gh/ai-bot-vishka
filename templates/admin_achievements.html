{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏ - AI –ë–æ—Ç{% endblock %}

{% block content %}
<div class="header">
    <a href="{{ url_for('main') }}" class="btn-back">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        –ù–∞–∑–∞–¥
    </a>
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏</h2>
    <div></div>
</div>

<div class="container">
    <div class="card mb-20">
        <h3 class="card-title">–°–æ–∑–¥–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</h3>
        <form id="addAchievementForm">
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" class="form-input" name="name" required>
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="form-textarea" name="description" required></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">–£—Å–ª–æ–≤–∏–µ (perfect_quiz, first_quiz, ten_quizzes)</label>
                <input type="text" class="form-input" name="condition" required>
            </div>
            <div class="form-group">
                <label class="form-label">–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç)</label>
                <input type="text" class="form-input" name="icon" value="üèÜ">
            </div>
            <button type="submit" class="btn btn-primary btn-block">–°–æ–∑–¥–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</button>
        </form>
    </div>
    
    <div class="card">
        <h3 class="card-title">–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h3>
        <div class="achievements-list">
            {% for achievement in achievements %}
            <div class="achievement-item" data-achievement-id="{{ achievement.id }}">
                <div class="achievement-info">
                    <div class="achievement-icon">{{ achievement.icon }}</div>
                    <div>
                        <h4>{{ achievement.name }}</h4>
                        <p style="color: var(--text-secondary); margin: 5px 0;">{{ achievement.description }}</p>
                        <small style="color: var(--text-secondary);">–£—Å–ª–æ–≤–∏–µ: {{ achievement.condition }}</small>
                    </div>
                </div>
                <div class="achievement-actions">
                    <button class="btn btn-secondary edit-achievement" data-id="{{ achievement.id }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-danger delete-achievement" data-id="{{ achievement.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.achievements-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.achievement-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 12px;
}

.achievement-info {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
}

.achievement-icon {
    font-size: 32px;
}

.achievement-actions {
    display: flex;
    gap: 8px;
}
</style>

<script>
    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    document.getElementById('addAchievementForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        
        showLoading();
        try {
            const response = await fetch('/api/admin/achievement', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'include',
                body: JSON.stringify(data)
            });
            const result = await response.json();
            hideLoading();
            
            if (result.success) {
                showNotification('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification(result.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è', 'error');
            }
        } catch (error) {
            hideLoading();
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        }
    });
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    document.querySelectorAll('.delete-achievement').forEach(btn => {
        btn.addEventListener('click', async function() {
            const id = this.dataset.id;
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ?')) return;
            
            showLoading();
            try {
                const response = await fetch(`/api/admin/achievement/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                const result = await response.json();
                hideLoading();
                
                if (result.success) {
                    showNotification('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(result.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                hideLoading();
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        });
    });
</script>
{% endblock %}

