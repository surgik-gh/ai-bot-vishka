{% extends "base.html" %}

{% block title %}Рейтинг - AI Бот{% endblock %}

{% block content %}
<div class="header">
    <h2>Рейтинг учеников</h2>
</div>

<div class="container">
    {% if current_user.role == 'student' and current_user_position %}
    <div class="card mb-20 leaderboard-user-card">
        <h3 class="card-title" style="color: white; display: flex; align-items: center; gap: 10px;">
            <img src="{{ url_for('static', filename='icons/trophy.svg') }}" alt="Трофей" style="width: 24px; height: 24px; filter: brightness(0) invert(1);">
            Ваша позиция
        </h3>
        <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; font-weight: bold; margin-bottom: 10px;">#{{ current_user_position }}</div>
            <div style="font-size: 18px; opacity: 0.9;">{{ current_user.rating }} очков</div>
            <div style="font-size: 14px; opacity: 0.8; margin-top: 10px;">
                {{ current_user.total_quizzes }} викторин • 
                {% if current_user.total_answers > 0 %}
                {{ ((current_user.total_correct_answers / current_user.total_answers) * 100)|round(1) }}% правильных ответов
                {% else %}
                0% правильных ответов
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="card">
        <h3 class="card-title">Таблица лидеров</h3>
        {% if leaderboard|length > 0 %}
        <div class="leaderboard-list">
            {% for entry in leaderboard %}
            <div class="leaderboard-item {% if entry.is_current_user %}current-user{% endif %}">
                <div class="leaderboard-position">
                    {% if entry.position == 1 %}
                        <img src="{{ url_for('static', filename='icons/medal-gold.svg') }}" alt="1 место" class="medal-icon" style="color: #FFD700;">
                    {% elif entry.position == 2 %}
                        <img src="{{ url_for('static', filename='icons/medal-silver.svg') }}" alt="2 место" class="medal-icon" style="color: #C0C0C0;">
                    {% elif entry.position == 3 %}
                        <img src="{{ url_for('static', filename='icons/medal-bronze.svg') }}" alt="3 место" class="medal-icon" style="color: #CD7F32;">
                    {% else %}
                        <span class="position-number">#{{ entry.position }}</span>
                    {% endif %}
                </div>
                <div class="leaderboard-user">
                    <div class="leaderboard-name">
                        {{ entry.user.first_name }} {{ entry.user.last_name }}
                        {% if entry.is_current_user %}
                        <span style="color: var(--accent); font-size: 12px; margin-left: 5px;">(Вы)</span>
                        {% endif %}
                    </div>
                    <div class="leaderboard-stats">
                        <span class="stat-item">
                            <img src="{{ url_for('static', filename='icons/chart.svg') }}" alt="Викторины" class="stat-icon">
                            {{ entry.total_quizzes }} викторин
                        </span>
                        <span class="stat-item">
                            <img src="{{ url_for('static', filename='icons/check.svg') }}" alt="Правильно" class="stat-icon">
                            {{ entry.total_correct_answers }}/{{ entry.total_answers }}
                        </span>
                        <span class="stat-item">
                            <img src="{{ url_for('static', filename='icons/trending-up.svg') }}" alt="Точность" class="stat-icon">
                            {{ entry.accuracy }}%
                        </span>
                    </div>
                </div>
                <div class="leaderboard-rating">
                    <div class="rating-value">{{ entry.rating }}</div>
                    <div class="rating-label">очков</div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-leaderboard">
            <img src="{{ url_for('static', filename='icons/empty-chart.svg') }}" alt="Нет данных" class="empty-icon">
            <p>Пока нет данных для рейтинга</p>
            <p class="empty-hint">Пройдите первую викторину, чтобы попасть в рейтинг!</p>
        </div>
        {% endif %}
    </div>
    
    <div class="card info-card">
        <h3 class="card-title info-title">
            <img src="{{ url_for('static', filename='icons/clipboard.svg') }}" alt="Информация" class="title-icon">
            Как начисляются очки?
        </h3>
        <div class="info-list">
            <div class="info-item">
                <img src="{{ url_for('static', filename='icons/check.svg') }}" alt="Правильно" class="info-icon success-icon">
                <span><strong>+10 очков</strong> за каждый правильный ответ</span>
            </div>
            <div class="info-item">
                <img src="{{ url_for('static', filename='icons/x.svg') }}" alt="Неправильно" class="info-icon error-icon">
                <span><strong>-1 очко</strong> за каждый неправильный ответ</span>
            </div>
            <div class="info-item">
                <img src="{{ url_for('static', filename='icons/star.svg') }}" alt="Бонус" class="info-icon star-icon">
                <span><strong>+50 очков</strong> бонус за идеальное прохождение викторины</span>
            </div>
            <div class="info-note">
                Рейтинг не может быть отрицательным
            </div>
        </div>
    </div>
</div>

<style>
.leaderboard-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.leaderboard-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.leaderboard-item:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.leaderboard-item.current-user {
    border-color: var(--accent);
    background: var(--card-bg-secondary);
    box-shadow: 0 2px 8px rgba(var(--accent-rgb), 0.2);
}

.leaderboard-position {
    width: 60px;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    color: var(--accent);
}

.position-number {
    font-size: 16px;
    color: var(--text-secondary);
}

.leaderboard-user {
    flex: 1;
    margin-left: 15px;
}

.leaderboard-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--text-primary);
    margin-bottom: 5px;
}

.leaderboard-stats {
    display: flex;
    gap: 15px;
    font-size: 12px;
    color: var(--text-secondary);
    flex-wrap: wrap;
}

.leaderboard-stats span {
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.stat-icon {
    width: 14px;
    height: 14px;
    opacity: 0.7;
}

.medal-icon {
    width: 32px;
    height: 32px;
}

.leaderboard-user-card {
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    color: white;
}

.empty-leaderboard {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-icon {
    width: 48px;
    height: 48px;
    margin-bottom: 15px;
    opacity: 0.3;
}

.empty-hint {
    font-size: 14px;
    margin-top: 10px;
    color: var(--text-secondary);
}

.info-card {
    margin-top: 20px;
    background: var(--card-bg-secondary);
}

.info-title {
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.title-icon {
    width: 18px;
    height: 18px;
    opacity: 0.8;
}

.info-list {
    padding: 10px 0;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.info-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
}

.success-icon {
    color: #10b981;
}

.error-icon {
    color: #ef4444;
}

.star-icon {
    color: #f59e0b;
}

.info-note {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
}

.leaderboard-rating {
    text-align: right;
    min-width: 80px;
}

.rating-value {
    font-size: 24px;
    font-weight: bold;
    color: var(--accent);
    line-height: 1;
}

.rating-label {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 2px;
}

@media (max-width: 480px) {
    .leaderboard-item {
        padding: 12px;
    }
    
    .leaderboard-position {
        width: 50px;
    }
    
    .leaderboard-user {
        margin-left: 10px;
    }
    
    .leaderboard-stats {
        gap: 10px;
    }
    
    .leaderboard-rating {
        min-width: 70px;
    }
    
    .rating-value {
        font-size: 20px;
    }
}
</style>
{% endblock %}

