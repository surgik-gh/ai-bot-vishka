# Решение проблем с OpenRouter API

## Ошибка 401: "Authorization error: header is incorrect"

### Причины и решения:

#### 1. Неправильный формат API ключа

**Проблема**: API ключ должен быть валидным ключом OpenRouter

**Решение**:
- Убедитесь, что вы используете **OpenRouter API ключ**, который вы создали в личном кабинете
- Ключ должен быть в формате, который предоставляет OpenRouter
- Проверьте в OpenRouter Dashboard, что вы скопировали правильный ключ

#### 2. Кавычки в .env файле

**Проблема**: Если в `.env` файле ключ обернут в кавычки, они могут передаваться как часть ключа

**Решение**:
```env
# ✅ Правильно (без кавычек):
OPENROUTER_API_KEY=ваш-openrouter-api-ключ

# ❌ Неправильно:
OPENROUTER_API_KEY="ваш-openrouter-api-ключ"
OPENROUTER_API_KEY='ваш-openrouter-api-ключ'
```

#### 3. Пробелы в начале/конце ключа

**Проблема**: Лишние пробелы могут вызывать ошибку авторизации

**Решение**: Код автоматически убирает пробелы, но проверьте вручную:
```env
# ✅ Правильно:
OPENROUTER_API_KEY=ваш-openrouter-api-ключ

# ❌ Неправильно (пробелы):
OPENROUTER_API_KEY= ваш-openrouter-api-ключ
OPENROUTER_API_KEY=ваш-openrouter-api-ключ
```

#### 4. Неактивный API ключ

**Проблема**: API ключ в OpenRouter может быть неактивным или отозванным

**Решение**:
1. Войдите в [OpenRouter Dashboard](https://openrouter.ai/keys)
2. Проверьте статус вашего API ключа
3. Убедитесь, что ключ активен
4. Проверьте, что у ключа есть необходимые права

#### 5. Ограничения по модели или региону

**Проблема**: У API ключа могут быть ограничения на доступ к определенным моделям

**Решение**:
- Убедитесь, что ваш API ключ имеет доступ к используемым моделям (например, anthropic/claude-3-haiku:beta)
- Проверьте настройки биллинга в OpenRouter

### Проверка API ключа

1. Откройте файл `.env`
2. Найдите строку `OPENROUTER_API_KEY=`
3. Убедитесь, что:
   - Нет кавычек вокруг значения
   - Нет пробелов в начале или конце
   - Ключ скопирован полностью

### Тестирование

После исправления:
1. Убедитесь, что зависимости установлены: `pip install -r requirements.txt`
2. Перезапустите приложение
3. Проверьте логи:
   - "INFO: Отправка запроса в OpenRouter API" - запрос отправлен
   - "INFO: Ответ получен от OpenRouter API" - успешный ответ
4. Если ошибка сохраняется, проверьте все пункты выше

### Использование OpenRouter API

OpenRouter API предоставляет доступ к различным LLM моделям через единый интерфейс. Код использует OpenRouter API для генерации текста и анализа материалов.

### Альтернатива: Локальные модели

Если проблемы с OpenRouter продолжаются, можно использовать локальные модели через Ollama или другие локальные решения:

1. Установите Ollama
2. Запустите локальную модель
3. Адаптируйте `openrouter_api.py` для использования локального эндпоинта

